
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tcore.org/design/fetch/">
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../decode/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../images/tcore.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>Fetch Stage - TCORE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#instruction-fetch-stage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TCORE" class="md-header__button md-logo" aria-label="TCORE" data-md-component="logo">
      
  <img src="../../images/tcore_back.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TCORE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fetch Stage
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/tr/" hreflang="tr" class="md-select__link">
              Turkish
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
    
  
  Design Details

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../blog/" class="md-tabs__link">
        
  
    
  
  Blog

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TCORE" class="md-nav__button md-logo" aria-label="TCORE" data-md-component="logo">
      
  <img src="../../images/tcore_back.png" alt="logo">

    </a>
    TCORE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Design Details
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Design Details
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Fetch Stage
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Fetch Stage
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-functionalities" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functionalities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    <span class="md-ellipsis">
      Ports
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stall_i-signal-description" class="md-nav__link">
    <span class="md-ellipsis">
      stall_i Signal Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fe_stall_i" class="md-nav__link">
    <span class="md-ellipsis">
      fe_stall_i
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lx_ires_i" class="md-nav__link">
    <span class="md-ellipsis">
      lx_ires_i
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pc_target_i" class="md-nav__link">
    <span class="md-ellipsis">
      pc_target_i
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spec_hit_i" class="md-nav__link">
    <span class="md-ellipsis">
      spec_hit_i
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spec_o" class="md-nav__link">
    <span class="md-ellipsis">
      spec_o
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pc_o-pc2_o-pc4_o" class="md-nav__link">
    <span class="md-ellipsis">
      pc_o, pc2_o, pc4_o
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inst_o" class="md-nav__link">
    <span class="md-ellipsis">
      inst_o
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_comp_o" class="md-nav__link">
    <span class="md-ellipsis">
      is_comp_o
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instantiations" class="md-nav__link">
    <span class="md-ellipsis">
      Instantiations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decode Stage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execute Stage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory Stage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writeback/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writeback Stage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="instruction-fetch-stage">Instruction Fetch Stage</h1>
<p>The <strong>Instruction Fetch (IF) stage</strong> is a critical part of the TCore pipeline, responsible for initiating the execution cycle by fetching instructions from memory. This stage integrates several essential modules that ensure smooth and efficient operation. Here is an overview of its core functionalities:</p>
<h2 id="core-functionalities">Core Functionalities</h2>
<ol>
<li><strong>Branch Prediction</strong>: </li>
<li>
<p>At the beginning of the fetch stage, branch prediction logic attempts to predict the outcome of branches (taken or not taken). This prediction minimizes stalls in the pipeline and ensures the processor continues executing instructions without waiting for the branch resolution.</p>
</li>
<li>
<p><strong>Program Counter (PC) Generation</strong>:</p>
</li>
<li>
<p>The Program Counter (PC) is updated dynamically based on the branch prediction output and the previous instruction's execution. This mechanism ensures that the correct instruction address is computed efficiently.</p>
</li>
<li>
<p><strong>Instruction Fetching</strong>:</p>
</li>
<li>
<p>Instructions are fetched from the instruction cache or main memory using the computed program counter. The fetched instructions are then passed on for further processing in subsequent stages.</p>
</li>
<li>
<p><strong>Compressed Instruction Decoding</strong>:</p>
</li>
<li>
<p>If the fetched instruction is a compressed (16-bit) RISC-V instruction, it is expanded into its full 32-bit equivalent. This step ensures compatibility with the standard execution pipeline and resolves alignment issues introduced by compressed instructions.</p>
</li>
<li>
<p><strong>Return Address Stack (RAS)</strong>:</p>
</li>
<li>The Return Address Stack (RAS) is a specialized structure used to store and retrieve return addresses for function calls. During the fetch stage, when a function call instruction is encountered, the return address is pushed onto the RAS. Conversely, when a return instruction is processed, the address is popped from the stack, ensuring accurate and efficient control flow handling. The RAS significantly improves performance by reducing branch mispredictions related to function calls and returns.</li>
</ol>
<h2 id="diagram">Diagram</h2>
<p><img alt="Diagram" src="../stage1_fetch.svg" title="Diagram" /></p>
<h2 id="ports">Ports</h2>
<table>
<thead>
<tr>
<th>Port name</th>
<th>Direction</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>clk_i</td>
<td>input</td>
<td></td>
</tr>
<tr>
<td>rst_ni</td>
<td>input</td>
<td></td>
</tr>
<tr>
<td>stall_i</td>
<td>input</td>
<td></td>
</tr>
<tr>
<td>fe_stall_i</td>
<td>input</td>
<td></td>
</tr>
<tr>
<td>lx_ires_i</td>
<td>input</td>
<td>ilowX_res_t</td>
</tr>
<tr>
<td>pc_target_i</td>
<td>input</td>
<td>[XLEN-1:0]</td>
</tr>
<tr>
<td>spec_hit_i</td>
<td>input</td>
<td></td>
</tr>
<tr>
<td>spec_o</td>
<td>output</td>
<td>predict_info_t</td>
</tr>
<tr>
<td>lx_ireq_o</td>
<td>output</td>
<td>ilowX_req_t</td>
</tr>
<tr>
<td>pc_o</td>
<td>output</td>
<td>[XLEN-1:0]</td>
</tr>
<tr>
<td>pc4_o</td>
<td>output</td>
<td>[XLEN-1:0]</td>
</tr>
<tr>
<td>pc2_o</td>
<td>output</td>
<td>[XLEN-1:0]</td>
</tr>
<tr>
<td>inst_o</td>
<td>output</td>
<td>[XLEN-1:0]</td>
</tr>
<tr>
<td>imiss_stall_o</td>
<td>output</td>
<td></td>
</tr>
<tr>
<td>is_comp_o</td>
<td>output</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="stall_i-signal-description"><code>stall_i</code> Signal Description</h3>
<p>The <code>stall_i</code> signal serves as a critical control mechanism to temporarily halt the pipeline under specific circumstances. This signal is asserted in the following scenarios:</p>
<ol>
<li>
<p><strong>Cache Misses</strong>:<br />
   When an instruction or data request results in a cache miss, the pipeline must pause until the required data is fetched from the memory hierarchy.</p>
</li>
<li>
<p><strong>Multi-Cycle ALU Operations</strong>:<br />
   During arithmetic or logic operations that require multiple clock cycles to complete, such as complex multiplications or divisions, the pipeline is stalled to prevent data hazards and ensure proper synchronization.</p>
</li>
</ol>
<p>By introducing controlled halts, the <code>stall_i</code> signal ensures that dependencies are resolved and the pipeline operates reliably without proceeding to the next stage prematurely.</p>
<h3 id="fe_stall_i"><code>fe_stall_i</code></h3>
<p>The <code>fe_stall_i</code> signal is used to indicate a pipeline stall caused by load dependencies. This occurs in classic scenarios where an instruction depends on the result of a prior load operation. To prevent data hazards, the pipeline is temporarily stalled until the required data is available for subsequent instructions.</p>
<p>This signal plays a crucial role in maintaining data consistency and ensuring that dependent instructions are executed correctly without introducing errors into the pipeline.</p>
<h3 id="lx_ires_i"><code>lx_ires_i</code></h3>
<p>The <code>lx_ires_i</code> signal represents the response port for lower hierarchy memory when handling instruction cache misses. When an instruction request results in a cache miss, this signal facilitates the retrieval of the required instruction data from the lower memory hierarchy.</p>
<h3 id="pc_target_i"><code>pc_target_i</code></h3>
<p>The <code>pc_target_i</code> signal carries the next Program Counter (PC) value determined during the execution stage. This value is typically computed based on branch decisions and directs the pipeline to the appropriate instruction address.</p>
<h3 id="spec_hit_i"><code>spec_hit_i</code></h3>
<p>The <code>spec_hit_i</code> signal indicates whether the branch prediction made earlier was correct. A high signal value confirms that the prediction was accurate, helping maintain pipeline efficiency by avoiding unnecessary stalls or flushes.</p>
<h3 id="spec_o"><code>spec_o</code></h3>
<p>The <code>spec_o</code> signal provides branch prediction information to the pipeline. It communicates whether a branch was taken and, if so, the target Program Counter (PC) value. This ensures smooth instruction flow during branching scenarios.</p>
<h3 id="pc_o-pc2_o-pc4_o"><code>pc_o</code>, <code>pc2_o</code>, <code>pc4_o</code></h3>
<p>These signals provide sequential Program Counter (PC) values to the pipeline:
- <code>pc_o</code>: The current Program Counter value.
- <code>pc2_o</code>: The current Program Counter plus 2, typically for compressed instruction alignment.
- <code>pc4_o</code>: The current Program Counter plus 4, for the next sequential 32-bit instruction.</p>
<h3 id="inst_o"><code>inst_o</code></h3>
<p>The <code>inst_o</code> signal carries the fetched instruction to the Decode stage. This ensures that the pipeline receives the necessary instruction data for further processing.</p>
<h3 id="is_comp_o"><code>is_comp_o</code></h3>
<p>The <code>is_comp_o</code> signal indicates whether the fetched instruction is a compressed (16-bit) instruction. This information is essential for ensuring proper handling and alignment within the pipeline.</p>
<h2 id="instantiations">Instantiations</h2>
<ul>
<li>ipma: pma</li>
<li>gray_align_buffer: gray_align_buffer</li>
<li>icache: icache</li>
<li>compressed_decoder: riscv_compressed_decoder</li>
<li>branch_prediction</li>
</ul>
<h1 id="pma-module-physical-memory-attributes">PMA Module: Physical Memory Attributes</h1>
<h2 id="diagram_1">Diagram</h2>
<p><img alt="Diagram" src="../pma.svg" title="Diagram" /></p>
<p>The <strong>PMA (Physical Memory Attributes)</strong> module is a key component in the TCore RISC-V Processor, designed to manage memory access and define specific behaviors for different memory regions. Below is an overview of its functionality and implementation details.</p>
<h2 id="key-features">Key Features</h2>
<ol>
<li><strong>Memory Region Classification</strong>:</li>
<li>
<p>The PMA module classifies memory regions based on predefined attributes such as cached/uncached and memory region type.</p>
</li>
<li>
<p><strong>Configurable Regions</strong>:</p>
</li>
<li>Supports multiple memory regions, with attributes defined in a structured format.</li>
</ol>
<h3 id="inputs-and-outputs">Inputs and Outputs</h3>
<ul>
<li><strong>Inputs</strong>:</li>
<li><code>addr_i</code>: The input address to be checked against the defined memory attributes.</li>
<li><strong>Outputs</strong>:</li>
<li><code>uncached_o</code>: Indicates whether the address belongs to an uncached region.</li>
<li><code>memregion_o</code>: Indicates whether the address is part of a recognized memory region.</li>
</ul>
<h3 id="internal-data-structure">Internal Data Structure</h3>
<ul>
<li>The module uses a structured type, <code>pma_t</code>, to represent each memory region. This includes:</li>
<li><code>addr</code>: Base address of the memory region.</li>
<li><code>mask</code>: Bitmask to define the size of the memory region.</li>
<li><code>uncached</code>: Specifies if the region is uncached.</li>
<li><code>memregion</code>: Specifies if the address belongs to a valid memory region.</li>
</ul>
<h3 id="memory-region-definitions">Memory Region Definitions</h3>
<p>The following regions are defined in the PMA module:</p>
<table>
<thead>
<tr>
<th>Region</th>
<th>Address Range</th>
<th>Cached</th>
<th>Memory Region</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Memregion</strong></td>
<td><code>0x4000_0000</code> - <code>0x400F_FFFF</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>UART</strong></td>
<td><code>0x2000_0000</code> - <code>0x2000_000F</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><strong>Timer</strong></td>
<td><code>0x3000_0000</code> - <code>0x3000_0007</code></td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h3 id="logical-flow">Logical Flow</h3>
<ol>
<li><strong>Region Matching</strong>:</li>
<li>Each incoming address is compared with predefined regions using the <code>addr</code> and <code>mask</code> fields.</li>
<li>
<p>Matching is performed with bitwise AND operations to efficiently check membership.</p>
</li>
<li>
<p><strong>Output Determination</strong>:</p>
</li>
<li>Based on the matching region, the outputs <code>uncached_o</code> and <code>memregion_o</code> are set accordingly.</li>
</ol>
<h2 id="use-cases">Use Cases</h2>
<ul>
<li><strong>Memory Management</strong>: Defines behaviors for different memory regions in the TCore pipeline.</li>
<li><strong>Peripheral Access</strong>: Ensures correct handling of UART and timer regions.</li>
</ul>
<h1 id="gray-align-buffer-instruction-alignment-for-compressed-instructions">Gray Align Buffer: Instruction Alignment for Compressed Instructions</h1>
<h2 id="diagram_2">Diagram</h2>
<p><img alt="Diagram" src="../gray_align_buffer.svg" title="Diagram" /></p>
<p>The <strong>Gray Align Buffer</strong> is a specialized module in the TCore RISC-V processor designed to handle instruction alignment, particularly for compressed instruction support. By leveraging a structure inspired by the Gray cache architecture, this module ensures seamless execution of compressed and uncompressed instructions.</p>
<h2 id="key-features_1">Key Features</h2>
<ol>
<li><strong>Support for Compressed Instructions</strong>:</li>
<li>Handles RISC-V compressed (16-bit) and uncompressed (32-bit) instructions effectively.</li>
<li>
<p>Ensures proper alignment for seamless decoding and execution in the pipeline.</p>
</li>
<li>
<p><strong>Even and Odd Buffering</strong>:</p>
</li>
<li>Separates instruction handling into even and odd parcels for optimized storage and retrieval.</li>
<li>
<p>Manages unaligned instructions efficiently, ensuring compatibility across different instruction formats.</p>
</li>
<li>
<p><strong>Conflict Resolution</strong>:</p>
</li>
<li>Resolves cache misses and overlaps dynamically using stateful logic for hit/miss detection.</li>
</ol>
<h3 id="internal-structure">Internal Structure</h3>
<ul>
<li><strong>Buffer Organization</strong>:</li>
<li>The buffer is divided into even and odd storage regions, optimized for efficient access.</li>
<li>
<p>Each buffer entry includes:</p>
<ul>
<li>Validity bit</li>
<li>Address tags</li>
<li>Data parcels for instruction storage</li>
</ul>
</li>
<li>
<p><strong>Tag Matching and Addressing</strong>:</p>
</li>
<li>Uses tags and masks to identify and locate instructions within the buffer.</li>
<li>Efficiently manages unaligned addresses using modular calculations.</li>
</ul>
<h2 id="use-cases_1">Use Cases</h2>
<ul>
<li><strong>Compressed Instruction Handling</strong>:</li>
<li>Essential for RISC-V cores supporting compressed instructions.</li>
<li><strong>Cache Optimization</strong>:</li>
<li>Provides seamless alignment and retrieval, reducing pipeline stalls.</li>
</ul>
<h1 id="icache-fully-configurable-instruction-cache">ICache: Fully Configurable Instruction Cache</h1>
<h2 id="diagram_3">Diagram</h2>
<p><img alt="Diagram" src="../icache.svg" title="Diagram" /></p>
<p>The <strong>ICache (Instruction Cache)</strong> module is a critical component of the TCore RISC-V processor, designed to optimize instruction fetching by reducing memory access latency and improving overall pipeline efficiency. Its configurable nature makes it adaptable for various system requirements.</p>
<h2 id="key-features_2">Key Features</h2>
<ol>
<li><strong>Fully Configurable Design</strong>:</li>
<li>
<p>Parameters such as cache size, block size, associativity, and word length are fully customizable, allowing the cache to be tailored to specific application needs.</p>
</li>
<li>
<p><strong>Multi-Way Associativity</strong>:</p>
</li>
<li>
<p>Supports multiple associativity levels, enabling flexible memory access patterns and enhanced performance.</p>
</li>
<li>
<p><strong>Cache Management</strong>:</p>
</li>
<li>Includes logic for handling cache hits, misses, and replacement policies.</li>
<li>Utilizes a pseudo-LRU (Least Recently Used) algorithm for efficient block replacement.</li>
</ol>
<h3 id="logical-flow_1">Logical Flow</h3>
<ol>
<li><strong>Instruction Fetch Request</strong>:</li>
<li>Receives fetch requests from the pipeline.</li>
<li>
<p>Determines whether the requested instruction block is present in the cache.</p>
</li>
<li>
<p><strong>Hit/Miss Detection</strong>:</p>
</li>
<li>On a hit, retrieves the instruction block directly from the cache.</li>
<li>
<p>On a miss, forwards the request to lower memory and updates the cache upon data retrieval.</p>
</li>
<li>
<p><strong>Cache Update</strong>:</p>
</li>
<li>Updates tag and data arrays with the fetched block from lower memory.</li>
<li>Maintains LRU state for future replacement decisions.</li>
</ol>
<h1 id="compressed-decoder-instruction-expansion-for-risc-v">Compressed Decoder: Instruction Expansion for RISC-V</h1>
<h2 id="diagram_4">Diagram</h2>
<p><img alt="Diagram" src="../riscv_compressed_decoder.svg" title="Diagram" /></p>
<p>The <strong>Compressed Decoder</strong> module is responsible for expanding RISC-V compressed (16-bit) instructions into their full 32-bit equivalents. This process ensures compatibility with the standard execution pipeline and seamless handling of mixed instruction formats.</p>
<h2 id="key-role">Key Role</h2>
<ul>
<li><strong>Instruction Expansion</strong>:</li>
<li>Decodes and converts compressed instructions into 32-bit instructions.</li>
</ul>
<h1 id="branch-prediction-enhancing-pipeline-efficiency">Branch Prediction: Enhancing Pipeline Efficiency</h1>
<h2 id="diagram_5">Diagram</h2>
<p><img alt="Diagram" src="../t_gshare.svg" title="Diagram" /></p>
<p>The <strong>Branch Prediction</strong> modules in the TCore RISC-V processor are designed to improve pipeline efficiency by minimizing branch-related stalls and ensuring smoother execution. Various branch prediction techniques are parametrically supported, each optimized for specific scenarios.</p>
<h2 id="supported-branch-predictors">Supported Branch Predictors</h2>
<h3 id="1-2-bit-dynamic-predictor">1. <strong>2-bit Dynamic Predictor</strong></h3>
<ul>
<li><strong>Overview</strong>: Utilizes a finite state machine (FSM) with four states (weak/strong taken, weak/strong not-taken) to dynamically predict branch outcomes based on past behavior.</li>
<li><strong>Advantages</strong>:</li>
<li>Adapts to branch patterns over time.</li>
<li>Balances accuracy and resource efficiency.</li>
<li><strong>Use Case</strong>: General-purpose pipelines with mixed branch behavior.</li>
</ul>
<h3 id="2-signed-branch-prediction">2. <strong>Signed Branch Prediction</strong></h3>
<ul>
<li><strong>Overview</strong>: Incorporates signed-unsigned differentiation in branch prediction. Separate FSMs track prediction states for signed and unsigned branches.</li>
<li><strong>Advantages</strong>:</li>
<li>Enhances prediction accuracy for signed and unsigned conditional branches.</li>
<li>Reduces mispredictions in workloads with mixed signed/unsigned branching.</li>
<li><strong>Use Case</strong>: Workloads with diverse branching conditions.</li>
</ul>
<h3 id="3-forward-always-taken-backward-not-taken-predictor">3. <strong>Forward Always-Taken, Backward Not-Taken Predictor</strong></h3>
<ul>
<li><strong>Overview</strong>: Predicts forward branches as always taken and backward branches as not taken. This static approach leverages the typical behavior of loops and forward jumps.</li>
<li><strong>Advantages</strong>:</li>
<li>Minimal hardware overhead.</li>
<li>Effective for loop-heavy workloads.</li>
<li><strong>Use Case</strong>: Embedded systems or applications with predictable branch patterns.</li>
</ul>
<h3 id="4-global-history-based-predictor-gshare">4. <strong>Global History-Based Predictor (GShare)</strong></h3>
<ul>
<li><strong>Overview</strong>: Combines a Global History Register (GHR) with a Pattern History Table (PHT) to correlate global branch history with outcomes.</li>
<li><strong>Advantages</strong>:</li>
<li>High accuracy for complex branch patterns.</li>
<li>Utilizes global context for prediction.</li>
<li><strong>Use Case</strong>: High-performance pipelines with intricate branching behavior.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2024 Kerim Turak – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            




  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="custom" checked>
          <span class="task-list-indicator"></span>
          Custom cookie
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.prune", "navigation.indexes", "toc.follow", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>